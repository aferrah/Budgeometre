{% extends "base.html" %}

{% block title %}Modifier une catégorie - Budgeomètre{% endblock %}

{% block head_extra %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/categories.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/modifier-categorie.css') }}">
{% endblock %}

{% block header_content %}
    <h1>Modifier une catégorie</h1>
{% endblock %}

{% block content %}
<main style="padding: 20px;">

    <section class="form-card">
        <h2>Modifier la catégorie : {{ categorie.nom }}</h2>

        <form method="post" action="{{ url_for('categories.modifier_categorie', id=categorie.idCategorie) }}">

            <div class="form-group">
                <label for="nom">Nom de la catégorie *</label>
                <input type="text" id="nom" name="nom" value="{{ categorie.nom }}" required>
            </div>

            <div class="form-group">
                <label for="description">Description</label>
                <textarea id="description" name="description" rows="3" placeholder="Description de la catégorie (optionnel)">{{ categorie.description or '' }}</textarea>
            </div>

            <div class="form-group">
                <label for="couleur">Couleur</label>
                <div class="color-preview">
                    <input type="color" id="couleur" name="couleur" value="{{ categorie.couleur or '#8b5cf6' }}" onchange="updateColorPreview()">
                </div>
            </div>

            <div class="form-group">
                <div class="checkbox-group">
                    <input type="checkbox" id="has_limit" {% if categorie.limite_budget and categorie.limite_budget > 0 %}checked{% endif %} onchange="toggleLimitInput()">
                    <label for="has_limit">Définir une limite de budget mensuel</label>
                </div>
                <input type="number" id="limite_budget" name="limite_budget"
                       value="{{ '%.2f'|format(categorie.limite_budget) if categorie.limite_budget else '' }}"
                       placeholder="Limite budget (€)" min="0" step="0.01"
                       style="{% if not categorie.limite_budget or categorie.limite_budget == 0 %}display: none;{% endif %}">
            </div>

            <div class="form-actions">
                <a href="{{ url_for('categories.categories') }}" class="btn btn-secondary">Annuler</a>
                <button type="submit" class="btn btn-primary">Enregistrer les modifications</button>
            </div>

        </form>
    </section>

</main>
{% endblock %}

{% block scripts %}
<script>
    function updateColorPreview() {
        const colorInput = document.getElementById('couleur');
        const colorPreview = document.getElementById('colorPreview');
        const colorCode = document.getElementById('colorCode');

        if (colorPreview) colorPreview.style.backgroundColor = colorInput.value;
        if (colorCode) colorCode.textContent = colorInput.value;
    }

    function toggleLimitInput() {
        const checkbox = document.getElementById('has_limit');
        const input = document.getElementById('limite_budget');

        if (checkbox.checked) {
            input.style.display = 'block';
            input.required = true;
        } else {
            input.style.display = 'none';
            input.required = false;
            input.value = '0';
        }
    }
</script>
{% endblock %}