{% extends "base.html" %}

{% block title %}Cat√©gories - Budgeom√®tre{% endblock %}

{% block head_extra %}
<style>
    .categories-page {
        max-width: 800px;
        margin: 0 auto;
        padding: 20px;
    }

    .categories-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 30px;
    }

    .categories-header h2 {
        margin: 0;
        color: white;
    }

    /* Formulaire d'ajout */
    .add-category-form {
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(10px);
        border-radius: 12px;
        padding: 20px;
        margin-bottom: 30px;
        border: 1px solid rgba(255, 255, 255, 0.2);
    }

    .add-category-form h3 {
        margin: 0 0 15px 0;
        color: white;
        font-size: 1.1rem;
    }

    .form-row {
        display: flex;
        gap: 15px;
        flex-wrap: wrap;
    }

    .form-row input[type="text"],
    .form-row input[type="color"] {
        flex: 1;
        min-width: 200px;
        padding: 12px 16px;
        border: 2px solid rgba(255, 255, 255, 0.3);
        border-radius: 8px;
        background: rgba(255, 255, 255, 0.1);
        color: white;
        font-size: 1rem;
    }

    .form-row input[type="color"] {
        min-width: 80px;
        height: 50px;
        flex: 0;
        cursor: pointer;
        border-radius: 8px;
        padding: 4px;
    }

    .form-row input[type="color"]::-webkit-color-swatch-wrapper {
        padding: 0;
    }

    .form-row input[type="color"]::-webkit-color-swatch {
        border: none;
        border-radius: 6px;
    }

    .form-row input[type="color"]::-moz-color-swatch {
        border: none;
        border-radius: 6px;
    }

    .form-row input[type="text"]::placeholder {
        color: rgba(255, 255, 255, 0.5);
    }

    .form-row input[type="text"]:focus {
        outline: none;
        border-color: #8b5cf6;
    }

    .btn-add {
        padding: 12px 24px;
        background: linear-gradient(135deg, #8b5cf6, #6366f1);
        border: none;
        border-radius: 8px;
        color: white;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
    }

    .btn-add:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 15px rgba(139, 92, 246, 0.4);
    }

    /* Liste des cat√©gories */
    .categories-list {
        display: grid;
        gap: 15px;
    }

    .category-card {
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(10px);
        border-radius: 12px;
        border: 1px solid rgba(255, 255, 255, 0.2);
        border-left: 4px solid;
        overflow: hidden;
        transition: all 0.3s ease;
    }

    .category-card:hover {
        background: rgba(255, 255, 255, 0.15);
    }

    .category-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 20px;
        cursor: pointer;
    }

    .category-info {
        flex: 1;
    }

    .category-name {
        font-size: 1.2rem;
        font-weight: 600;
        color: white;
        margin-bottom: 5px;
    }

    .category-description {
        font-size: 0.9rem;
        color: rgba(255, 255, 255, 0.6);
    }

    .category-stats {
        text-align: right;
        color: rgba(255, 255, 255, 0.8);
    }

    .category-stats .count {
        font-size: 1.5rem;
        font-weight: 700;
        color: #8b5cf6;
    }

    .category-stats .label {
        font-size: 0.8rem;
        color: rgba(255, 255, 255, 0.5);
    }

    .category-actions {
        display: flex;
        align-items: center;
        gap: 10px;
        margin-left: 15px;
    }

    .btn-toggle {
        padding: 8px 12px;
        background: rgba(139, 92, 246, 0.2);
        border: 2px solid #8b5cf6;
        border-radius: 6px;
        color: #8b5cf6;
        cursor: pointer;
        transition: all 0.3s ease;
        font-size: 0.9rem;
    }

    .btn-toggle:hover {
        background: #8b5cf6;
        color: white;
    }

    .btn-toggle.active {
        background: #8b5cf6;
        color: white;
    }

    .btn-delete {
        padding: 8px 12px;
        background: rgba(239, 68, 68, 0.2);
        border: 2px solid #ef4444;
        border-radius: 6px;
        color: #ef4444;
        cursor: pointer;
        transition: all 0.3s ease;
    }

    .btn-delete:hover {
        background: #ef4444;
        color: white;
    }

    /* D√©roulant des transactions */
    .transactions-dropdown {
        max-height: 0;
        overflow: hidden;
        transition: max-height 0.3s ease;
        background: rgba(0, 0, 0, 0.2);
        border-top: 1px solid rgba(255, 255, 255, 0.1);
    }

    .transactions-dropdown.open {
        max-height: 500px;
    }

    .transactions-list {
        padding: 15px 20px;
    }

    .transaction-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 12px 15px;
        background: rgba(255, 255, 255, 0.05);
        border-radius: 8px;
        margin-bottom: 10px;
    }

    .transaction-item:last-child {
        margin-bottom: 0;
    }

    .transaction-info {
        flex: 1;
    }

    .transaction-titre {
        font-weight: 600;
        color: white;
        margin-bottom: 3px;
    }

    .transaction-date {
        font-size: 0.8rem;
        color: rgba(255, 255, 255, 0.5);
    }

    .transaction-montant {
        font-weight: 700;
        font-size: 1.1rem;
    }

    .transaction-montant.positif {
        color: #10b981;
    }

    .transaction-montant.negatif {
        color: #ef4444;
    }

    .no-transactions {
        color: rgba(255, 255, 255, 0.5);
        text-align: center;
        padding: 15px;
        font-style: italic;
    }

    .empty-state {
        text-align: center;
        padding: 40px;
        color: rgba(255, 255, 255, 0.6);
    }

    .empty-state p {
        font-size: 1.1rem;
    }
</style>
{% endblock %}

{% block header_content %}
    <h1>Cat√©gories des d√©penses</h1>
    <a href="{{ url_for('home') }}" class="btn-back">‚Üê Retour √† l'accueil</a>
{% endblock %}

{% block content %}
<main class="categories-page">

    <div class="categories-header">
        <h2>Cat√©gories</h2>
    </div>

    <!-- Formulaire d'ajout -->
    <div class="add-category-form glass-card">
        <h3> Ajouter une cat√©gorie</h3>
        <form method="post" action="{{ url_for('categories') }}">
            <div class="form-row">
                <input type="text" name="nom" placeholder="Nom de la cat√©gorie" required>
                <input type="text" name="description" placeholder="Description (optionnel)">
                <input type="color" name="couleur" value="#8b5cf6" title="Couleur de la cat√©gorie">
                <button type="submit" class="btn-add">Ajouter</button>
            </div>
        </form>
    </div>

    <!-- Liste des cat√©gories -->
    <div class="categories-list">
        {% if categories %}
            {% for cat in categories %}
                <div class="category-card" style="border-left-color: {{ cat.couleur or '#8b5cf6' }};">
                    <div class="category-header">
                        <div class="category-info">
                            <div class="category-name">
                                {{ cat.nom }}
                            </div>
                            <div class="category-description">{{ cat.description or 'Aucune description' }}</div>
                        </div>
                        <div class="category-stats">
                            <div class="count">{{ cat.transactions|length }}</div>
                            <div class="label">transaction(s)</div>
                        </div>
                        <div class="category-actions">
                            <button type="button" class="btn-toggle" onclick="toggleTransactions(this, 'transactions-{{ cat.idCategorie }}')">
                                ‚ñº Voir
                            </button>
                            <form method="post" action="{{ url_for('delete_category', id=cat.idCategorie) }}" style="display:inline;">
                                <button type="submit" class="btn-delete" onclick="return confirm('Supprimer cette cat√©gorie ?')">üóëÔ∏è</button>
                            </form>
                        </div>
                    </div>

                    <!-- D√©roulant des 3 derni√®res transactions -->
                    <div class="transactions-dropdown" id="transactions-{{ cat.idCategorie }}">
                        <div class="transactions-list">
                            {% set derniers_transactions = cat.transactions|sort(attribute='dateTransaction', reverse=true)|list %}
                            {% if derniers_transactions %}
                                {% for t in derniers_transactions[:3] %}
                                    <div class="transaction-item">
                                        <div class="transaction-info">
                                            <div class="transaction-titre">{{ t.titre }}</div>
                                            <div class="transaction-date">{{ t.dateTransaction.strftime('%d/%m/%Y') }}</div>
                                        </div>
                                        <div class="transaction-montant {{ 'positif' if t.montant >= 0 else 'negatif' }}">
                                            {{ '+' if t.montant >= 0 else '' }}{{ '%.2f'|format(t.montant) }} ‚Ç¨
                                        </div>
                                    </div>
                                {% endfor %}
                            {% else %}
                                <div class="no-transactions">Aucune transaction dans cette cat√©gorie</div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            {% endfor %}
        {% else %}
            <div class="empty-state glass-card">
                <p>Aucune cat√©gorie pour l'instant.</p>
                <p>Ajoutez-en une ci-dessus !</p>
            </div>
        {% endif %}
    </div>

</main>
{% endblock %}

{% block scripts %}
<script>
    function toggleTransactions(btn, id) {
        const dropdown = document.getElementById(id);
        dropdown.classList.toggle('open');
        btn.classList.toggle('active');

        if (dropdown.classList.contains('open')) {
            btn.textContent = 'Masquer';
        } else {
            btn.textContent = 'Voir';
        }
    }
</script>
{% endblock %}